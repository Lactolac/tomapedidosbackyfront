import{b as N}from"./index-B-mgjAW1.js";import{s as z,a as V}from"./index-8B6jVA3a.js";import{_ as w,u as E,o as M,c as S,p as u,C as T,a as d,h as b,w as C,D,E as I}from"./index-pguNv6pf.js";const B={name:"GoogleMap",props:{operaciones:{type:Array,required:!0}},setup(){const{isDarkTheme:o,getDarkModeStyles:a,getLightModeStyles:s}=E();return{isDarkTheme:o,getDarkModeStyles:a,getLightModeStyles:s}},watch:{operaciones:{handler(){Array.isArray(this.operaciones)&&this.operaciones.length>0?this.loadGoogleMapsApi().then(()=>{console.log("Google Maps API loaded"),this.initMap()}).catch(o=>{console.error("Error loading Google Maps API:",o)}):console.warn("No operations to display on the map.")},immediate:!0,deep:!0},isDarkTheme:{handler(o){this.map&&(this.map.setOptions({styles:o?this.getDarkModeStyles:this.getLightModeStyles}),this.updateMarkers())},immediate:!0}},methods:{loadGoogleMapsApi(){return new Promise((o,a)=>{if(typeof google<"u"){o();return}window.onGoogleMapsLoad=()=>o();const s=document.createElement("script");s.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBY9DdqQA0qfNATg16j54HHQtu-_hG4VJc&libraries=places&callback=onGoogleMapsLoad",s.onerror=a,document.head.appendChild(s)})},initMap(){if(!Array.isArray(this.operaciones)||this.operaciones.length===0){console.error("No hay operaciones para mostrar en el mapa.");return}const o=this.operaciones[0],a={center:{lat:parseFloat(o.lat),lng:parseFloat(o.lng)},zoom:14,styles:this.isDarkTheme?this.getDarkModeStyles:this.getLightModeStyles};this.map=new google.maps.Map(this.$refs.map,a),this.updateMarkers()},updateMarkers(){if(!Array.isArray(this.operaciones)){console.error("No hay operaciones para mostrar en el mapa.");return}try{this.markers&&this.markers.forEach(t=>t.setMap(null)),this.markers=[];const o=[],a=new Map,s={"Inicio de sesión":"https://img.icons8.com/stickers/50/nft-user.png","Cambio de ubicación":"https://img.icons8.com/stickers/50/track-order.png","Terminar día":"https://img.icons8.com/dusk/64/task-completed.png","Entrega realizada (parcial)":"https://img.icons8.com/skeuomorphism/64/delivery.png","Entrega realizada (entregado)":"https://img.icons8.com/stickers/50/paid.png","Entrega realizada (no_entregado)":"https://img.icons8.com/stickers/50/delete-sign.png"};this.operaciones.forEach(t=>{let r=parseFloat(t.lat),c=parseFloat(t.lng);const i=`${r},${c}`;if(a.has(i)){const f=a.get(i)*1e-5;r+=f,c+=f,a.set(i,a.get(i)+1)}else a.set(i,1);const g={lat:r,lng:c};o.push(g);let y=s[t.tipoSinNumero]||s["Entrega realizada (entregado)"];const h=new google.maps.Marker({position:g,map:this.map,title:t.tipo,icon:{url:y,scaledSize:new google.maps.Size(42,42),labelOrigin:new google.maps.Point(21,50)},label:t.numero?{text:t.numero.toString(),color:"white",fontSize:"24px",fontWeight:"bold"}:null}),n=`
                      <div class="info-window-content">
                          <p class="font-semibold text-lg">Acción: ${t.tipo}</p>
                          <p class="font-semibold text-lg">Usuario: ${t.usuario||"N/A"}</p>
                          <p class="font-semibold text-lg">Cliente: ${t.cliente||"N/A"}</p>
                          <p class="font-semibold text-lg">Entrega: ${t.vbeln||"N/A"}</p>
                          <p class="font-semibold text-lg">Fecha-Hora: ${t.fechaHora||"N/A"}</p>
                      </div>
                  `,e=new google.maps.InfoWindow({content:n});h.addListener("click",()=>{e.open(this.map,h)}),this.markers.push(h)}),new google.maps.Polyline({path:o,geodesic:!0,strokeColor:"#e98d58",strokeOpacity:1,strokeWeight:4}).setMap(this.map),console.log("Path coordinates:",o)}catch(o){console.error("Error updating markers:",o)}}}},j={ref:"map",class:"map-container"};function G(o,a,s,m,t,r){return M(),S("div",j,null,512)}const P=w(B,[["render",G]]),F={class:"flex items-center gap-x-4 mb-4"},L={class:"flex items-center gap-x-2"},H={class:"flex items-center gap-x-2"},O={class:"flex items-center gap-x-2"},U={class:"flex h-screen"},W={__name:"Dashboard",setup(o){const{showAlert:a}=E(),s=u(""),m=u([]),t=u(new Date),r=u(""),c=u("Todas las ubicaciones"),i=u([]),g=()=>{const n=new Date,e={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0};s.value=n.toLocaleString("es-ES",e)},y=()=>{const n=localStorage.getItem("rutas");n?m.value=JSON.parse(n):m.value=[]},h=async()=>{try{if(!r.value||!t.value||!c.value){a({title:"Campos incompletos",text:"Por favor, selecciona la ruta, fecha y filtro antes de buscar.",icon:"warning",confirmButtonText:"Entendido"});return}const n=r.value,e=t.value.toLocaleDateString("es-ES").replace(/\//g,"-"),k={"Todas las ubicaciones":"T","No incluir cambios de ubicacion":"E","Cambios de ubicacion":"U"}[c.value],v=localStorage.getItem("token");if(!v)throw new Error("Token no disponible. Por favor, inicia sesión.");const p=await D.get(`https://calidad-yesentregas-api.yes.com.sv/logs/${n}/${e}/${k}`,{headers:{Authorization:`Bearer ${v}`}});if(p.data){let A=0;i.value=p.data.filter(l=>["Inicio de sesión","Entrega realizada (parcial)","Entrega realizada (entregado)","Entrega realizada (no_entregado)","Terminar día","Cambio de ubicación"].includes(l.json_accion.Accion)).map(l=>{let _=l.json_accion.Accion,$=_,x=null;return["Entrega realizada (parcial)","Entrega realizada (entregado)","Entrega realizada (no_entregado)"].includes(_)&&(x=++A),{lat:parseFloat(l.json_accion.latitudEntregador),lng:parseFloat(l.json_accion.longitudEntregador),tipo:_,tipoSinNumero:$,cliente:l.json_accion.kunnag,fechaHora:l.json_accion["fecha-hora"],usuario:l.json_accion.Username,vbeln:l.json_accion.vbeln,numero:x}}),console.log("Operaciones obtenidas:",i.value)}else a({title:"Sin operaciones",text:"No se encontraron operaciones para esta ruta.",icon:"info",confirmButtonText:"Entendido"})}catch(n){console.error("Error al obtener las operaciones de la ruta:",n),a({title:"Error",text:"Hubo un problema al obtener las operaciones de la ruta.",icon:"error",confirmButtonText:"Entendido"})}};return T(()=>{g(),setInterval(g,1e3),y()}),(n,e)=>{const f=z,k=V,v=N;return M(),S("div",null,[d("div",F,[d("div",L,[e[3]||(e[3]=d("div",{class:"font-semibold text-l"},"Ingresa la fecha:",-1)),b(f,{modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=p=>t.value=p),showIcon:!0,showButtonBar:!0},null,8,["modelValue"])]),d("div",H,[e[4]||(e[4]=d("div",{class:"font-semibold text-l"},"Ingresa la ruta:",-1)),b(k,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=p=>r.value=p),options:m.value,placeholder:"Selecciona la ruta"},null,8,["modelValue","options"])]),d("div",O,[e[5]||(e[5]=d("div",{class:"font-semibold text-l"},"Filtrar por:",-1)),b(k,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=p=>c.value=p),options:["Todas las ubicaciones","No incluir cambios de ubicacion","Cambios de ubicacion"],placeholder:"Selecciona el filtro"},null,8,["modelValue"])]),b(v,{onClick:h,class:"px-4 py-2 bg-blue-500 text-white rounded"},{default:C(()=>e[6]||(e[6]=[I("Buscar")])),_:1})]),d("div",U,[b(P,{class:"custom-google-map",operaciones:i.value},null,8,["operaciones"])])])}}},R=w(W,[["__scopeId","data-v-9af9d5e9"]]);export{R as default};
